
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Nicole's Thesis, IIT 2018
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[table]{iitthesis}
% Document Options:
%
% Note if you want to save paper when printing drafts,
% replace the above line by
%
%   \documentclass[draft]{iitthesis}
%
% See Help file for more about options.
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{setspace}
\usepackage{cite}
\usepackage{amsmath} % \boldsymbol
\usepackage{graphicx} % \includegraphics
\usepackage[nodayofweek]{datetime} % \today

% If we use hyperref, we can automatically embed this metadata into the PDF
\usepackage{hyperref}
%\hypersetup{pdftex,
%	hidelinks, % I don't like when it makes those colored boxes around hyperlinks, comment out to restore
%	pdfauthor={Nicole Neveu (nicole.r.neveu@gmail.com)},
%	pdftitle={Nicole's IIT PhD Thesis},
%	pdfsubject={PhD Thesis},
%	pdfkeywords={Accelerator, Physics, IIT, thesis, Latex}}

% Make sure that \includegraphics finds pdf BEFORE png (the default is png first)
% https://tex.stackexchange.com/questions/45498/choosing-whether-to-include-pdf-or-png-in-pdflatex
\usepackage{grfext}
\PrependGraphicsExtensions*{.pdf}

%\usepackage{rotating}           % This package is used for landscape mode.
%\usepackage{epsfig}
\usepackage{siunitx}

%\usepackage[shortcuts]{extdash}
%\renewcommand{\thefootnote}{\arabic{footnote}}
\usepackage{url}
\usepackage{booktabs}
\usepackage[american]{circuitikz}
\usepackage{tikz}
\usetikzlibrary{shapes.misc}
\usetikzlibrary{shapes,arrows,decorations.markings,shadows,positioning}

%% Only for editing process...TAKE OUT for FINAL DRAFT
\usepackage{xcolor}
\usepackage{enumitem}
\newcommand{\lsnote}[1]{\textsf{{\color{violet}{ LS note:}   #1 }}}
\newcommand{\nrnote}[1]{\textsf{{\color{blue}{ NN note:}   #1 }}}
\newcommand{\jpnote}[1]{\textsf{{\color{green}{ JP note:}   #1 }}}
%Strikeout command
\usepackage[normalem]{ulem}

%Code formatting
\usepackage{listings}
\usepackage{color}

\definecolor{Gray}{gray}{0.9}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
	keywordstyle=\color{magenta},
	numberstyle=\small\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\small,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=left,                    
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2
}

\lstset{style=mystyle}

\usepackage{array}
\newcolumntype{C}{ >{\centering\arraybackslash} m{2.5cm} }
\newcolumntype{D}{ >{\centering\arraybackslash} m{3cm} }
\usepackage{makecell}


\begin{document}

\title{Fully Staged Two Beam Acceleration at the Argonne Wakefield Accelerator Facility}

\author{Nicole Neveu }
\degree{Doctor of Philosophy}
\dept{Physics}
\date{December 2018}
\copyrightnoticetrue      % crate copyright page or not
%\coadvisortrue           % add co-advisor. activate it by removing % symbol to add co-advisor
\maketitle                % create title and copyright pages


\prelimpages         % Settings of preliminary pages are done with \prelimpages command

%%%  Acknowledgement %%%
\begin{acknowledgement}     % acknowledgement environment, this is optional
	\par  Family, Lalo, Linda, John, AWA group, Jeff
	%\input{ackno.tex} % you need a separate acknowledgement.tex file to include it.
\end{acknowledgement}

% Table of Contents
\tableofcontents
\clearpage

% List of Tables
\listoftables
\clearpage

%List of Figures
\listoffigures
\clearpage

%List of Symbols(optional)

\listofsymbols
\SymbolDefinition{$c$}{Speed of Light}
\SymbolDefinition{$\epsilon$}{Dielectric Permittivity}
\SymbolDefinition{$\epsilon_n$}{Normalized Emittance}
\SymbolDefinition{$\gamma$}{Lorentz Factor}

\clearpage


%%% Abstract %%%
\begin{abstract}           % abstract environment, this is optional
	\par Two beam acceleration is a candidate for future high energy physics machines and FEL user facilities. 
	This scheme consists of two independent electron beam lines operating synchronously. \lsnote{More explanation of two beam acceleration generically above including why it is attractive, and then say something below about AWA before moving on to the detailed description.}
	High-charge, 70 MeV drive bunch trains are injected from the RF photoinjector into decelerating 
	structures to generate a few hundred MW's of RF power. 
	This RF power is transferred through an RF waveguide to accelerating structures that are used to accelerate the witness beam. 
	Staging refers to the sequential acceleration (energy gain) in two or more structures on the witness beam line. \lsnote{Summarize the work needed for the fully staged demo, and then summarize what you contributed toward that.}
	A kicker was incorporated on the drive beam line to accomplish a modular design so that each accelerating structure can be independently powered by a separate drive beam. 
	Simulations were performed in OPAL-T to model the beam lines. 
	Beam size at the center of the structures was minimized to ensure good charge transmission. 
	Energy spread was minimized for bunches traveling through the kicker and dipoles. 
	The resulting design will be the basis for proof of principle experiments that will take place at the Argonne Wakefield Accelerator (AWA) facility. Installation of the beam line has begun 
	and initial results are also shown.
	 
\end{abstract}

\textpages     % Settings of text-pages are done with \textpages command

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\input{introduction}
%\clearpage

%\input{exp_setup}
%\clearpage

%\input{simulations}
%\clearpage

\input{beam_line_design}
\clearpage

%\input{exp_results}
%\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\footnote{My Footnote} 
\Chapter{CONCLUSION}
%   \input{Conclusion.tex}
Conclusion...

\clearpage


%
% APPENDIX
%
\appendix

\Appendix{How to build OPAL on Bebop at ANL} \label{build}
This set of instructions is tailored to the bebop cluster at ANL. 
Intel compilers and intel-MPI were used to build OPAL and all 
the libraries it is dependent on.
\begin{enumerate}[label=Step \arabic*:]
	\item Load modules 

I purge modules first, this will force an error message if any changes
to the system modules occur.
\begin{lstlisting}
	module purge
	module load intel
	module load intel-mpi 
	module load cmake 
	module load gmp   
	module load mpfr  
	module load mpc   
	module load hdf5   
	module load gsl   
	module load intel-mkl
	module load szip
\end{lstlisting}

    \item Set environment variables for compilers 
 
These variables point to intel compilers. 
\begin{lstlisting}
CC=mpiicc;CXX=mpiicpc;F90=ifort;F77=ifort
export CC CXX F90 F77
\end{lstlisting}

    \item Set environment variables for self built libraries.
    
I built these libraries separately because they were not available as 
modules on the cluster. 

\begin{lstlisting}
	export PATH="/blues/gpfs/home/neveu/git/H5hut-2.0.0rc3/build:${PATH}"
	
	export H5HUT_HOME=$HOME/git/H5hut-2.0.0rc3/build_intel
	export H5HUT_PREFIX=$H5HUT_HOME
	export H5HUT_DIR=$H5HUT_HOME
	export H5HUT_INCLUDE_DIR=$H5HUT_HOME/include
	export H5HUT_LIBRARY_DIR=$H5HUT_HOME/lib
	
	export BOOST_HOME=$HOME/git/boost_1_62_0/build/
	export BOOST_DIR=$BOOST_HOME
	export BOOST_PREFIX=$BOOST_HOME
	export BOOST_INCLUDE_DIR=$BOOST_HOME/include
	export BOOST_LIBRARY_DIR=$BOOST_HOME/lib
	export BOOST_ROOT=/home/neveu/git/boost_1_62_0/
	echo $BOOST_ROOT
	echo $BOOST_DIR
\end{lstlisting}

    \item Call cmake 
    
There are two cmake calls I use depending on if I'm building for 
BDW (\verb|-axCORE-AVX2|) or KNL (\verb|-axMIC-AVX512|) architecture. 
    
\begin{lstlisting}
cmake -DCMAKE_INSTALL_PREFIX=/home/neveu/software/opal-1.9/bdw -DCMAKE_CXX_FLAGS="-lsz -axCORE-AVX2" ..
\end{lstlisting}

    \item Call make, then make install
I usually call make with a large number of cores to speed up the compilation.    
\begin{lstlisting}
	make -j 30 
	make install
\end{lstlisting}

\end{enumerate}



%\moretox

\Appendix{Converting 3D field maps to OPAL convention}\label{3dmaps}


\Appendix{OPAL Optimization Input File} \label{opt-tba-code}
The following code was used for production optimization runs on Bebop at the LCRC.
\makeatletter
\let\@currsize\normalsize
\makeatother 
\begin{singlespacing}
	\begin{verbatim}
	OPTION, ECHO=FALSE;
	OPTION, INFO=FALSE;
	
	TITLE, STRING="First full ANL AWA optimisation ";
	
	dv0: DVAR, VARIABLE="IBF",    LOWERBOUND=300.0, UPPERBOUND=500.0;
	dv1: DVAR, VARIABLE="IM",     LOWERBOUND=180.0, UPPERBOUND=280.0;
	//dv2: DVAR, VARIABLE="GPHASE", LOWERBOUND=-20.0, UPPERBOUND=10.0;
	//dv3: DVAR, VARIABLE="FWHM",   LOWERBOUND=1.5,   UPPERBOUND=10.0;
	
	// Quad values
	dv4: DVAR, VARIABLE="KQ1", LOWERBOUND=-8.0, UPPERBOUND=8.0;
	dv5: DVAR, VARIABLE="KQ2", LOWERBOUND=-8.0, UPPERBOUND=8.0;
	dv6: DVAR, VARIABLE="KQ3", LOWERBOUND=-8.0, UPPERBOUND=8.0;
	dv7: DVAR, VARIABLE="KQ4", LOWERBOUND=-8.0, UPPERBOUND=8.0;
	
	//Phases
	//dv8:  DVAR, VARIABLE="P1", LOWERBOUND=-20.0, UPPERBOUND=20.0;
	//dv9:  DVAR, VARIABLE="P2", LOWERBOUND=-20.0, UPPERBOUND=20.0;
	//dv10: DVAR, VARIABLE="P3", LOWERBOUND=-20.0, UPPERBOUND=20.0;
	//dv11: DVAR, VARIABLE="P4", LOWERBOUND=-20.0, UPPERBOUND=20.0;
	//dv12: DVAR, VARIABLE="P5", LOWERBOUND=-20.0, UPPERBOUND=20.0;
	//dv13: DVAR, VARIABLE="P6", LOWERBOUND=-20.0, UPPERBOUND=20.0;
	
	//dv8:  DVAR, VARIABLE="KQ5", LOWERBOUND=-6.0, UPPERBOUND=6.0;
	//dv9:  DVAR, VARIABLE="KQ6", LOWERBOUND=-6.0, UPPERBOUND=6.0;
	//dv10: DVAR, VARIABLE="KQ7", LOWERBOUND=-8.0, UPPERBOUND=8.0;
	//dv11: DVAR, VARIABLE="KQ8", LOWERBOUND=-8.0, UPPERBOUND=8.0;
	//dv12: DVAR, VARIABLE="KQ9", LOWERBOUND=-8.0, UPPERBOUND=8.0;
	
	//Q5 Entrance
	de3: OBJECTIVE,EXPR="fabs(statVariableAt('dE',19.4))";
	rmss3: OBJECTIVE,EXPR="fabs(statVariableAt('rms_s',19.4))";
	rmsx3: OBJECTIVE,EXPR="fabs(statVariableAt('rms_x',19.4))";
	rmsy3: OBJECTIVE,EXPR="fabs(statVariableAt('rms_y',19.4))";
	rmspx3: OBJECTIVE,EXPR="fabs(statVariableAt('rms_px',19.4))";
	rmspy3: OBJECTIVE,EXPR="fabs(statVariableAt('rms_py',19.4))";
	
	//Kicker apeture
	c1: CONSTRAINT, EXPR="fabs(statVariableAt('rms_x',16.5))<0.1";
	c2: CONSTRAINT, EXPR="fabs(statVariableAt('rms_y',16.5))<0.1";
	c3: CONSTRAINT, EXPR="fabs(statVariableAt('rms_y',16.5)
							-statVariableAt('rms_x',16.5))<0.005";
	
	OPTIMIZE, INPUT="tmpl/optLinac-40nC.tmpl",
	OUTPUT="optLinac-40nC",
	OUTDIR="results",
	OBJECTIVES = {rmsx3, rmsy3, rmss3, rmspx3, rmspy3, de3},
	DVARS = {dv0, dv1, dv4, dv5, dv6, dv7},
	CONSTRAINTS = {c1, c2, c3},  //, c7, c8, c9, c10},
	INITIALPOPULATION=656,
	MAXGENERATIONS=200,
	NUM_MASTERS=1,
	NUM_COWORKERS=8,
	SIMTMPDIR="tmp",
	TEMPLATEDIR="tmpl",
	FIELDMAPDIR="fieldmaps",
	NUM_IND_GEN=328,
	GENE_MUTATION_PROBABILITY=0.01,
	MUTATION_PROBABILITY=0.01,
	RECOMBINATION_PROBABILITY=0.09;
	QUIT;
	\end{verbatim}	
\end{singlespacing}



\newpage
%
% BIBLIOGRAPHY
%
\bibliographystyle{IEEEtran}
\bibliography{thesis}

\end{document}  % end of document





























